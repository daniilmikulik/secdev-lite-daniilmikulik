# S03 - Шаблон реестра NFR (Given-When-Then)

## Таблица реестра NFR

| ID      | User Story / Feature | Category              | Requirement (NFR)                                                                                                          | Rationale / Risk                                                  | Acceptance (G-W-T)                                                                                                                                                                                  | Evidence (test/log/scan/policy)                                 | Trace (issue/link) | Owner           | Status | Priority    | Severity      | Tags                    |
| ------- | -------------------- | --------------------- | -------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- | ------------------ | --------------- | ------ | ----------- | ------------- | ----------------------- |
| NFR-001 | US-006               | Performance           | P95 latency для GET /api/items ≤ 300ms при 250 RPS в течение 5 мин                                                         | UX при работе с большими списками                                 | **Given** сервис под нагрузкой 1000 RPS<br>**When** GET /api/items с любыми входными параметрами<br>**Then** 429 Too Many Requests                                                                  | Нагрузочный тест                                                | #PERF-001          | Perf-team       | Draft  | P1 - High   | S2 - Major    | performance, latency    |
| NFR-002 | US-006               | Scalability           | Автоскейлинг поддерживает P95 ≤ 300ms при росте нагрузки до 500 RPS                                                        | Обеспечение доступности при всплесках                             | **Given** базовая нагрузка 250 RPS<br>**When** нагрузка возрастает до 500 RPS за 2 мин<br>**Then** P95 ≤ 300ms, автоскейлинг добавляет ≥1 реплику                                                   | Мониторинг автоскейлинга, метрики CPU, RAM, HDD                 | #SCALE-001         | DevOps          | Draft  | P2 - Medium | S2 - Major    | scalability             |
| NFR-003 | US-006               | API-Contract/Errors   | Все ошибки возвращаются по RFC 7807; параметры пагинации: 1 ≤ limit ≤ 100, offset ≥ 0. По умолчанию limit = 10, offest = 0 | Предсказуемость API, защита от перегрузки при запросе всех данных | **Given** запрос с limit=150 или offset=-1<br>**When** GET /api/items<br>**Then** 422 + RFC 7807 с детализацией                                                                                     | Валидационные схемы, генерация клиента на базе спецификации API | #API-001           | Backend-team    | Draft  | P2 - Medium | S3 - Minor    | api, validation         |
| NFR-004 | US-006               | Observability/Logging | Все запросы к /api/items содержат correlation_id; логируются ключевые параметры (limit, offset, result_count)              | Трассировка проблем производительности                            | **Given** запрос без X-Correlation-ID<br>**When** GET /api/items?limit=20&offset=0<br>**Then** 422 + RFC 7807 с детализацией                                                                        | Структурированные логи, Jaeger/ELK                              | #OBS-001           | DevOps          | Draft  | P2 - Medium | S3 - Minor    | logging, observability  |
| NFR-005 | US-011               | Security-AuthZ/RBAC   | Пользователь tenant A не может получить доступ к ресурсам tenant B; роли admin/manage/viewer имеют строгие границы         | Изоляция данных, compliance                                       | **Given** пользователь с ролью viewer из tenant A<br>**When** запрос GET /api/org/resources tenant B<br>**Then** 404 без возврата данных                                                            | Интеграционные тесты RBAC, security scan                        | #SEC-001           | Security-team   | Draft  | P1 - High   | S1 - Critical | rbac, isolation         |
| NFR-006 | US-011               | Security-AuthZ/RBAC   | Только admin может изменять роли; запрет эскалации привилегий                                                              | Контроль доступа, принцип наименьших привилегий                   | **Given** пользователь с ролью manager<br>**When** POST /api/org/users/{id}/role на назначение admin<br>**Then** 403 + audit log                                                                    | Тесты авторизации, проверка политик                             | #SEC-002           | Security-team   | Draft  | P1 - High   | S1 - Critical | rbac, authorization     |
| NFR-007 | US-011               | Privacy/PII           | PII данные (email, имена) маскируются в логах; срок хранения сырых PII ≤ 30 дней                                           | Соответствие GDPR, защита приватности                             | **Given** пользователь с email "user@example.com"<br>**When** операция логируется<br>**Then** email не фигурирует в логах                                                                           | Логи приложения, политика хранения данных                       | #PRIV-001          | Data-protection | Draft  | P1 - High   | S1 - Critical | pii, privacy, gdpr      |
| NFR-008 | US-011               | Auditability          | Все изменения ролей логируются с who/what/when/result; записи защищены от изменений                                        | Расследование инцидентов, compliance                              | **Given** рядовой пользователь пытается изменить роль пользователя<br>**When** POST /api/org/users/{id}/role **Then** 403, audit log содержит: actor, target, old_role, new_role, timestamp, status | Централизованный audit log, WORM-хранилище                      | #AUDIT-001         | Audit-team      | Draft  | P2 - Medium | S2 - Major    | audit, compliance       |
| NFR-009 | US-011               | Security-AuthN        | Все запросы к /api/org/\* требуют валидный JWT с проверкой срока действия                                                  | Защита от неавторизованного доступа                               | **Given** запрос с просроченным JWT<br>**When** POST /api/org/users/{id}/role<br>**Then** 401 + RFC 7807                                                                                            | Тесты аутентификации, security scan                             | #SEC-003           | Security-team   | Draft  | P1 - High   | S1 - Critical | authentication, jwt     |
| NFR-010 | US-011               | Data-Integrity        | Все SQL-запросы используют white list разрешенных параметров; tenant_id проверяется на каждом уровне                       | Защита от SQL injection, обеспечение изоляции                     | **Given** пользователь tenant A<br>**When** выполняется запрос к БД с потенциальной инъекцией<br>**Then** 422 + RFC 7807, WHERE включает tenant_id=A                                                | Code review, статический анализ кода                            | #SEC-004           | Backend-team    | Draft  | P1 - High   | S1 - Critical | sql-injection, security |

## Памятка по заполнению

- **Измеримость.** В `Requirement` фиксируйте числа и границы (мс, RPS, минуты, MiB, коды 4xx/5xx, CVSS).
- **Проверяемость.** В `Acceptance (G-W-T)` используйте объективные условия и наблюдаемые факты (код ответа, квантиль, наличие заголовка, запись в лог).
- **Связность.** Сверяйте, чтобы NFR не конфликтовали (timeouts vs retry, rate limits vs SLO, privacy vs logging).
- **План проверки.** В `Evidence` укажите, чем это будет подтверждаться позже (test/log/scan/policy). В рамках семинара **реальные артефакты не требуются**.
- **Трассировка.** В `Trace` добавляйте ссылки на Issues/документы, чтобы потом не искать контекст.

---

## После семинара

- Перенесите/доработайте **8-10 утверждённых NFR** (по сути, те же строки) в раздел **NFR** вашего `GRADING/TM.md`.
- На S04-S05 свяжете эти NFR с угрозами (STRIDE) и ADR - по ID.

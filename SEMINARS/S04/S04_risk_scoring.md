# S04 - Шаблон приоритизации рисков L×I (risk scoring template)

Этот файл агрегирует риски из `S04_stride_matrix.md`:

- **объединяем дубликаты**,
- выставляем **L** и **I** (1-5),
- считаем **Score = L×I**,
- фиксируем **Top-5** и рабочие названия будущих **ADR** (решений для S05).

> Рабочее расположение у студента: `SEMINARS/S04/S04_risk_scoring.md`.
> Оценок/«сдач» нет. Семинарские артефакты в `/EVIDENCE/` **не кладём**.

---

## Как работать с шаблоном

1. Просмотрите `S04_stride_matrix.md` и **склейте похожие угрозы** в единые формулировки (consolidation).
2. Для каждой записи:

   - кратко опишите **суть риска** (Consolidated Description),
   - укажите **Threat** (S/T/R/I/D/E), **NFR link (ID)** (или `need NFR`),
   - выставьте **L** и **I** (по шкале ниже) и кратко обоснуйте каждую оценку,
   - посчитайте **Score = L×I**,
   - пометьте **Decision (Top-5?)** и впишите черновой **ADR candidate**.

---

## Шкала L×I (1-5)

**Likelihood (вероятность):**
1 - маловероятно (редкая поверхность, сложная эксплуатация, хорошая детекция)
2 - низкая
3 - средняя
4 - высокая
5 - очень высокая (публичная поверхность, типовая уязвимость, слабая детекция)

**Impact (ущерб):**
1 - низкий (локальный эффект, без PII/денег/доступности)
2 - умеренный
3 - значимый (PII/деньги одного клиента/подсистемы)
4 - высокий (существенный ущерб/простой)
5 - критичный (массовая утечка, компрометация прав, длительный простой)

**Score = L × I** -> сортируем по убыванию -> отмечаем **Top-5**.

---

## Тай-брейкеры при равенстве Score

- **Blast radius** - масштаб затрагиваемых пользователей/тенантов/данных.
- **Detectability** - насколько быстро обнаружим (логи/алерты/аудит) или это скрытно.
- **Compliance** - приватность/платёжные/регуляторные последствия.
- **Time-to-Mitigate** - насколько быстро/безопасно закрывается.
- **Dependency risk** - зависит от внешних провайдеров/узких мест.

---

## Таблица приоритизации (заполняйте)

| Risk ID  | Source (DFD/Row)                                | Consolidated Description                                                                           | Threat (S/T/R/I/D/E)       | NFR link (ID)    | L (1-5) | Rationale-L                                                                                                   | I (1-5) | Rationale-I                                                                                                           | **Score (=L×I)** | Decision (Top-5?) | ADR candidate                                 |
| -------- | ----------------------------------------------- | -------------------------------------------------------------------------------------------------- | -------------------------- | ---------------- | ------: | ------------------------------------------------------------------------------------------------------------- | ------: | --------------------------------------------------------------------------------------------------------------------- | ---------------: | ----------------- | --------------------------------------------- |
| **R-01** | Edge: WS -> Logs, Logs_Service, Logs_PostgreSQL | **Утечка PII в логи** и их несанкционированное чтение.                                             | I (Information Disclosure) | NFR-007          |       4 | Очень распространенная ошибка — логирование целых объектов для отладки, что случайно захватывает PII.         |       4 | Нарушение GDPR/законов о приватности. Высокий репутационный ущерб и возможные штрафы. Затрагивает всех пользователей. |           **16** | **Top-1**         | PII Masking and Anonymization in Logs         |
| **R-02** | Edge: UA -> GW, Wishlist_GW                     | **Отказ в обслуживании (DoS)** из-за DDoS-атак или исчерпания ресурсов.                            | D (Denial of Service)      | NFR-001, NFR-002 |       4 | Публичные API — постоянная цель для автоматизированных атак и ботнетов. Вероятность атаки высока.             |       4 | Полный или частичный простой сервиса, затрагивающий всех клиентов. Прямые финансовые и репутационные потери.          |           **16** | **Top-2**         | Rate Limiting & Autoscaling Strategy          |
| **R-03** | Wishlist_Service, Edge: WS -> PG                | **Обход изоляции тенантов** и доступ к чужим данным через уязвимости в логике.                     | I / E                      | NFR-005, NFR-010 |       3 | Классическая уязвимость в multi-tenant системах (IDOR, отсутствие `WHERE tenant_id`). Легко допустить ошибку. |       5 | Критическое нарушение: компрометация данных всех клиентов. Полная потеря доверия, массовая утечка данных.             |           **15** | **Top-3**         | Tenant Isolation via Row-Level Security (RLS) |
| **R-04** | Wishlist_Service                                | **Эскалация привилегий** через обход RBAC, позволяющая пользователю получить права администратора. | E (Elevation of Privilege) | NFR-005, NFR-006 |       3 | Требует знания бизнес-логики, но ошибки в проверках прав являются частым явлением в сложных системах.         |       5 | Полная компрометация системы. Злоумышленник может управлять всеми данными и пользователями.                           |           **15** | **Top-4**         | Centralized RBAC Enforcement Policy           |
| **R-05** | Edge: UA -> GW                                  | **Несанкционированный доступ к аккаунту** через кражу/перехват/повторное использование JWT.        | S (Spoofing)               | NFR-009          |       4 | Фишинг, вредоносное ПО на стороне клиента, перехват токена в незащищенных сетях — частые сценарии.            |       3 | Ущерб ограничен одним пользователем, но включает кражу его PII и возможность действий от его имени.                   |           **12** | **Top-5**         | JWT Lifecycle and Security Policy             |
| **R-06** | Edge: WS -> PG                                  | **Выполнение произвольного кода в БД (SQL-инъекция)** для кражи или изменения данных.              | T / I                      | NFR-010          |       2 | Современные ORM значительно снижают риск, но он все еще существует при использовании raw SQL-запросов.        |       5 | Потенциальная компрометация всей базы данных, включая данные всех тенантов; возможность удаления данных.              |           **10** |                   | Secure DB Access Policy (ORM only)            |
| **R-07** | Все рёбра/узлы                                  | **Невозможность расследовать инцидент** из-за потери логов или отсутствия сквозной трассировки.    | R (Repudiation)            | NFR-004, NFR-008 |       3 | Сбои в системе логирования или ошибки в конфигурации могут легко привести к потере данных для аудита.         |       3 | Затрудняет расследование, но не наносит прямого ущерба пользователям. Влияет на compliance и внутренние процессы.     |            **9** |                   | Resilient Auditing and Tracing                |
| **R-08** | Logs_Service, Edge: Logs -> L-PG                | **Несанкционированное изменение/удаление аудит-логов** для сокрытия следов.                        | T / R                      | NFR-008          |       2 | Требует доступа к системе логов, что маловероятно для внешнего актора, но возможно для инсайдера.             |       4 | Подрыв доверия к системе аудита. Критично для прохождения compliance-проверок и расследования инцидентов.             |            **8** |                   | Immutable Log Storage (WORM)                  |

## Что получаем по итогам заполнения

- Очистили дубли и получили **сжатый список рисков**.
- У каждого риска есть **L×I (1-5)** с обоснованием и **Score**.
- Отмечен **Top-5** и намечены **ADR candidate** - готовность к S05.
